name: Commit jobs
on: [push, pull_request]
jobs:
    pylint:
        name: Linting - Pylint
        runs-on: ubuntu-20.04
        strategy:
            matrix:
                python-version: [2,3]
        steps:
            - name: Check out code
              uses: actions/checkout@v2
              with:
                  lfs: true
            - name: Lint in docker
              run: |
                  docker run \
                      --rm \
                      --interactive \
                      --volume ${{ github.workspace }}:/host_dir \
                      --workdir /host_dir ubuntu:20.04 \
                      bash -c \
                      "./Tools/Lint/setup.sh && python3 Tools/Lint/pylint.py --python-versions ${{ matrix.python-version }}"
    create-installer:
        name: Create installer
        runs-on: windows-2019
        steps:
            # - name: Check out code
            #   uses: actions/checkout@v2
            #   with:
            #       lfs: true
            # - name: Build
            #   shell: cmd
            #   run: |
            #       Powershell -NoProfile -ExecutionPolicy Bypass -File "${{ github.workspace }}\Tools\CI\fix_sources_timestamps.ps1"
            #       call ${{ github.workspace }}\Tools\_AppveyorTestBuild.bat
            #       call ${{ github.workspace }}\Tools\CI\DeployBuild.bat
            #       call ${{ github.workspace }}\Tools\_TrimFBuildCache.bat
            - name: Testing candle
              shell: cmd
              run: cd %PROGRAMFILES(X86)% && dir
            - name: testing 2
              shell: cmd
              run: cd %PROGRAMFILES% && dir
            - name: testing 3
              shell: cmd
              run: dir
            #- name: testing 4
            #  shell: cmd
            #  run: "c: && dir /s candle.exe"
            #- name: testing 5
            #  shell: cmd
            #  run: cd ..\.. && dir /s candle.exe
            #- name: testing 6
            #  shell: cmd
            #  run: "c: && cd %PROGRAMFILES(X86)% && dir /s candle.exe"
            - name: testing 7
              shell: powershell
              run: '& "$env:PROGRAMFILES(X86)/WiX Toolset v3.11/bincandle.exe"'
            - name: Create a dummy file
              run: echo "some text" > hello.txt
            # - name: Upload a test file
            #   uses: actions/upload-artifact@v2
            #   with:
            #       name: hello
            #       path: hello.txt
    validate-xml:
        name: Validate XMLs
        runs-on: windows-2019
        steps:
            - name: Check out code
              uses: actions/checkout@v2
              with:
                  lfs: true
            - name: Run XmlValidator
              run: |
                cd ${{ github.workspace }}\Tools
                ${{ github.workspace }}\Tools\XmlValidator.exe -a
